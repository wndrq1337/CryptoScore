# CryptoScoreV2

![image](https://github.com/user-attachments/assets/250f7808-950f-47de-82a3-a10d8a0ab9ea)

## Описание индикатора
**CryptoScoreV2** — это многофункциональный индикатор, созданный для анализа криптовалютных и других финансовых рынков. Он объединяет несколько популярных технических инструментов (Ишимоку, RSI, MACD, скользящие средние и волатильность) в единый показатель (`SCORE`), который помогает трейдерам принимать решения о покупке или продаже актива. Индикатор также учитывает дивергенции между ценой и осцилляторами (RSI и MACD), что делает его особенно полезным для выявления потенциальных разворотов рынка.

### Основные особенности:
- **Общий балл (`SCORE`)**: Сводный показатель, основанный на нескольких индикаторах.
- **Динамическая цветовая индикация**: Цвет средней скользящей меняется в зависимости от уровня волатильности.
- **Уровни BUY/SELL**: Визуальные линии для определения зон покупки и продажи.
- **Дивергенции**: Выявление бычьих и медвежьих дивергенций для прогнозирования разворотов.

---

## Как пользоваться индикатором

1. **Показатель SCORE**:
   - Значение `SCORE` колеблется в диапазоне `[0, 1]`.
   - Если `SCORE > 0.65`, это сигнал к покупке (BUY).
   - Если `SCORE < 0.35`, это сигнал к продаже (SELL).
   - Значения между `0.35` и `0.65` указывают на нейтральную зону.

2. **Средняя скользящая MA**:
   - Красный цвет: Высокая волатильность, рынок нестабилен.
   - Черный цвет: Низкая волатильность, рынок спокоен.

3. **Дивергенции**:
   - Бычья дивергенция (Bullish Divergence): Возможен рост цены. Отображается зеленым фоном.
   - Медвежья дивергенция (Bearish Divergence): Возможен спад цены. Отображается красным фоном.

4. **Рекомендации**:
   - Используйте индикатор в сочетании с другими инструментами анализа (например, уровни поддержки/сопротивления).
   - Не полагайтесь только на сигналы `SCORE`. Учитывайте контекст рынка и дополнительные данные.

---

## Работа кода

### 1. **Ишимоку**
Индикатор Ишимоку используется для определения тренда и областей поддержки/сопротивления. В данном случае мы используем только облако Ишимоку:
- `cloudTop`: Верхняя граница облака.
- `cloudBot`: Нижняя граница облака.
- `iScore`: Значение, которое зависит от положения цены относительно облака:
  - `1`: Цена выше облака (бычий тренд).
  - `0`: Цена ниже облака (медвежий тренд).
  - `0.5`: Цена внутри облака (нейтральная зона).

### 2. **RSI**
RSI (Relative Strength Index) измеряет силу тренда:
- Мы нормализуем значения RSI в диапазоне `[0, 1]` с помощью кастомной функции `math.clamp`.
- `rScore`: Нормализованное значение RSI.

### 3. **MACD**
MACD (Moving Average Convergence Divergence) используется для анализа импульса:
- Разница между линиями MACD и сигнала (`macd - sig`) нормализуется с помощью стандартного отклонения.
- `mScore`: Нормализованное значение MACD.

### 4. **Скользящие средние**
Мы используем две скользящие средние (SMA и EMA):
- `maScore`: Сумма баллов за положение цены относительно SMA(50) и EMA(20).

### 5. **Волатильность**
Волатильность рассчитывается как среднее значение трех метрик:
- ATR (Average True Range).
- Стандартное отклонение цены.
- Средний диапазон между максимумами и минимумами.
- `vol`: Финальное значение волатильности.

### 6. **Дивергенции**
Дивергенции выявляются между ценой и осцилляторами (RSI и MACD):
- Бычья дивергенция: Цена падает, но осциллятор растет.
- Медвежья дивергенция: Цена растет, но осциллятор падает.
- `divScore`: Добавляет бонусные баллы (+0.15 или -0.15) к общему `SCORE`.

### 7. **Веса**
Каждый компонент (`iScore`, `rScore`, `mScore`, `maScore`, `divScore`) имеет свой вес:
- Веса зависят от уровня волатильности (`vol`), чтобы адаптироваться к текущему состоянию рынка.

### 8. **Итоговый SCORE**
Финальный показатель `SCORE` рассчитывается как взвешенная сумма всех компонентов:
```pinescript
score = iScore * tw + rScore * rw + mScore * mw + maScore * 0.15 + divScore
```

### 9. **Графики**
- Линия `SCORE` отображается синим цветом.
- Уровни BUY (0.65) и SELL (0.35) отмечены пунктирными линиями.
- Средняя скользящая (`MA of SCORE`) изменяет цвет в зависимости от волатильности:
  - Красный: Высокая волатильность.
  - Черный: Низкая волатильность.
- Дивергенции отображаются фоновым цветом:
  - Зеленый фон: Бычья дивергенция.
  - Красный фон: Медвежья дивергенция.

---

## Пример использования
1. Откройте график актива в TradingView.
2. Добавьте индикатор `CryptoScore+Div`.
3. Наблюдайте за значением `SCORE`:
   - Если `SCORE > 0.65`, рассмотрите возможность покупки.
   - Если `SCORE < 0.35`, рассмотрите возможность продажи.
4. Обратите внимание на цвет средней скользящей:
   - Красный: Будьте осторожны, рынок нестабилен.
   - Черный: Рынок спокоен, можно искать точки входа.
5. Проверяйте наличие дивергенций для дополнительного подтверждения сигналов.

---
